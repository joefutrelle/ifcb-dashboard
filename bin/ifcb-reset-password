#!/bin/bash
export PYTHONPATH=/vagrant
export BIN_PATH=/vagrant/bin/do

function test_retval {
    if (($? > 0)); then
	echo "Canceled."
	exit 1
    fi
}

dialog --yesno "Are you sure you want to reset the administrator password for the IFCB dashboard?" 7 50
test_retval

USER='admin@whoi.edu'

while [ 1 ]; do
    dialog --title "Set password" --inputbox "Enter the new password for user $USER" 9 40 2>.pwd1
    test_retval
    password1=$(cat .pwd1)

    dialog --title "Confirm password" --inputbox "Confirm the new password for user $USER" 9 40 2>.pwd2
    test_retval
    password2=$(cat .pwd2)

    rm .pwd1 .pwd2
    
    if [[ $password1 == $password2 ]]; then
	python $BIN_PATH/password_reset.py $password1 | dialog --progressbox "Resetting password..." 9 45
	dialog --infobox "Successfully reset password." 4 40
	echo "Successfully reset password."
	break
    fi

    dialog --yesno "Passwords do not match, try again" 9 40
    test_retval
done

